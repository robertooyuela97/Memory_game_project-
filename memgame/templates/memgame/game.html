<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memory Game - {{ level }}</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    {% load static %}
    <link rel="stylesheet" href="{% static 'memgame/css/style.css' %}">
</head>
<body>
    <div class="container">
        <h1>Memory Game - Nivel {{ level }}</h1>

        <p>Intentos restantes: <span id="attempts-left">{{ initial_attempts }}</span></p>
        <p>
            Tiempo restante:
            <span id="time-left" data-initial-time-limit="{{ game_time_limit }}">{{ game_time_limit }}</span>
            segundos
        </p>

        <div id="game-board" class="row"></div>

        <p class="mt-4 text-center">
            <a href="{% url 'memgame:select_level' %}" class="btn btn-info">
                Volver a Seleccionar Nivel
            </a>
        </p>
    </div>

    <div class="modal fade" id="endGameModal" tabindex="-1" aria-labelledby="endGameLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center">
                <div class="modal-header">
                    <h5 class="modal-title w-100" id="endGameLabel"></h5>
                </div>
                <div class="modal-body" id="endGameMessage"></div>
                <div class="modal-footer justify-content-center">
                    <a id="next-level-btn" class="btn btn-success d-none">Siguiente nivel</a>
                    <button type="button" class="btn btn-primary" onclick="location.reload()">Jugar de nuevo</button>
                    <a href="{% url 'memgame:select_level' %}" class="btn btn-secondary">Seleccionar otro Nivel</a>
                </div>
            </div>
        </div>
    </div>

    <audio id="flip-sound" src="{% static 'memgame/sounds/flip.mp3' %}" preload="auto"></audio>
    <audio id="victory-sound" src="{% static 'memgame/sounds/victory.mp3' %}" preload="auto"></audio>
    <audio id="defeat-sound" src="{% static 'memgame/sounds/derrota.mp3' %}" preload="auto"></audio>
    <audio id="background-music" src="{% static 'memgame/sounds/background_music.mp3' %}" preload="auto" loop></audio>

    {{ cards|json_script:"cards-data" }}

    <script>
        const cardsData = JSON.parse(document.getElementById('cards-data').textContent);
        const gameSessionId = parseInt('{{ game_session_id }}');
        const gameLevelName = "{{ level|escapejs }}";
        const profileUrl = "{% url 'memgame:profile' %}";
        const endGameUrl = "{% url 'memgame:game_end_api' game_session_id %}";
        const selectLevelUrl = "{% url 'memgame:select_level' %}";
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'memgame/js/game.js' %}"></script>
</body>
</html>
